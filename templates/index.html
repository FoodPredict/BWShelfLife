<!DOCTYPE html>
<html>
<head>
    <title>Buckwheat Flour Shelf Life Predictor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        form {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], select {
            width: 200px;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        input[type="submit"], button { /* Apply styles to buttons as well */
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px; /* Add some spacing between buttons */
        }
        input[type="submit"]:hover, button:hover {
            background-color: #45a049;
        }
         button.secondary { /* Style for the Clear Input button */
            background-color: #f44336; /* Red color */
        }
        button.secondary:hover {
            background-color: #d32f2f; /* Darker red */
        }
        .prediction {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: #333; /* Dark grey color for prediction text */
        }
         .buttons {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <h1>Buckwheat Flour Shelf Life Predictor</h1>
    <form id="predictionForm"> <!-- Added an ID to the form -->
        <label for="moisture">Moisture (%):</label>
        <input type="number" id="moisture" name="moisture" step="0.01" required><br>

        <label for="temperature">Storage Temperature (Â°C):</label>
        <input type="number" id="temperature" name="temperature" step="0.01" required><br>

        <label for="season">Season:</label>
        <select id="season" name="season" required>
            <option value="Spring">Spring</option>
            <option value="Summer">Summer</option>
            <option value="Autumn">Autumn</option>
            <option value="Winter">Winter</option>
            <option value="Rainy">Rainy</option>
        </select><br>

        <label for="rh">RH (%):</label>
        <input type="number" id="rh" name="rh" step="0.01" required><br>

        <label for="days_after_milling">Days after milling:</label>
        <input type="number" id="days_after_milling" name="days_after_milling" step="0.01" required><br>

        <label for="packing">Packing:</label>
        <select id="packing" name="packing" required>
            <option value="Vacuum">Vacuum</option>
            <option value="Closed">Closed</option>
            <option value="Open">Open</option>
        </select><br>

        <label for="ffa">Free Fatty Acids (%):</label>
        <input type="number" id="ffa" name="ffa" step="0.01" required><br>

        <input type="submit" value="Predict Shelf Life">
        <!-- Added Edit and Clear buttons -->
        <button type="button" onclick="enableInput()">Edit Input</button>
        <button type="button" onclick="clearInput()" class="secondary">Clear Input</button>
    </form>

    <div id="predictionResult" class="prediction">
        {% if prediction_text %}
            {{ prediction_text }}
        {% endif %}
    </div>

    <script>
        const form = document.getElementById('predictionForm');
        const predictionResultDiv = document.getElementById('predictionResult');
        const inputs = form.querySelectorAll('input, select'); // Get all input and select elements

        // Function to disable input fields after prediction
        function disableInput() {
            inputs.forEach(input => {
                input.disabled = true;
            });
        }

        // Function to enable input fields for editing
        function enableInput() {
            inputs.forEach(input => {
                input.disabled = false;
            });
        }

        // Function to clear input fields
        function clearInput() {
            form.reset(); // Reset the form
            predictionResultDiv.innerText = ''; // Clear the prediction text
            enableInput(); // Ensure inputs are enabled after clearing
        }

        // Disable input fields initially if there's a prediction displayed on load
        window.onload = function() {
            if (predictionResultDiv.innerText.trim() !== '') {
                disableInput();
            }
        }


        form.addEventListener('submit', function(event) {
            // Prevent the default form submission
            event.preventDefault();

            // Collect form data
            const formData = new FormData(form);

            // Send data asynchronously
            fetch('/predict', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(html => {
                // Find the prediction text within the returned HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const predictionText = doc.getElementById('predictionResult').innerText; // Get the prediction text from the new HTML

                // Update the prediction result div
                predictionResultDiv.innerText = predictionText;

                // Disable input fields after successful prediction
                disableInput();
            })
            .catch(error => {
                console.error('Error:', error);
                predictionResultDiv.innerText = 'Error predicting shelf life.';
                 enableInput(); // Enable input on error
            });
        });
    </script>
</body>
</html>
